<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>Document</title>
</head>

<body>
    <P>异步：代码更复杂</P>
    <p>同步：代码简单</p>
    <h1>Promise 消除异步操作</h1>
    <p>用同步的方式，来书写异步代码</p>



    <!-- <script>
        let p = new Promise(
            function (resolve, reject) {
                $.ajax({
                    url: 'arr1.txt',
                    dataType: 'json',
                    success(arr) {
                        resolve(arr)
                    },
                    error(err) {
                        reject(err)
                    }
                })
            }
        )

        p.then(
            function (arr) {
                alert('succsess')
                console.log(arr);
            },
            function (err) {
                alert('fail')
                console.log(err);
            }
        )
    </script> -->


    <!-- <script>
        $.ajax({url:"https://geoapi.qweather.com/v2/city/lookup?location=chaoyang&key=09071cb27ee14c1c98b9e77819c148f8",dataType:"json"}).then(
            res=>{
                console.log(res);
            },err=>{
                alert('失败')
            }
        )

    </script> -->
    <!-- https://www.bilibili.com/video/BV1uK411H7on?p=49 -->
    <script>
        function getJSON(url) {
            return new Promise(
                (resolve, reject) => {
                    $.ajax({
                        url,
                        dataType: 'json',
                        success(arr) {
                            resolve(arr)
                        },
                        error(err) {
                            reject(err)
                        }
                    })
                }
            )
        }

        // const res = getWeather('https://geoapi.qweather.com/v2/city/lookup?location=chaoyang&key=09071cb27ee14c1c98b9e77819c148f8')
        // console.log(res);

        // getWeather('https://geoapi.qweather.com/v2/city/lookup?location=chaoyang&key=09071cb27ee14c1c98b9e77819c148f8').then(val=>{console.log(val);},err=>{console.log('错误');})

        function 第一个() {
            alert('第一个')
        }
        function 第二个() {
            console.log('第二个函数');
        }
        function 第三个() {
            console.log('第三个函数');
        }

        async function main() {

            try {
                console.log('main start')
                第一个()

                let res1Slow = await getJSON('http://127.0.0.1:65500/set/')
                console.log('1', res1Slow);

                第二个()
                let resSlow = await getJSON('http://127.0.0.1:65500/test')
                console.log('2', resSlow);

                第三个()

                let res = await getJSON('https://geoapi.qweather.com/v2/city/lookup?location=chaoyang&key=09071cb27ee14c1c98b9e77819c148f8')
                console.log('3', res);

                console.log('end main');
            } catch (e) {
                console.log('发现错误：', e);
                alert(e.readyState)
            }

        }

        console.log('program start');
        main()
        console.log('program end');
        console.log('其他程序');

    </script>

</body>

</html>